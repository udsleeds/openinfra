<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Transport Infrastructure Data Packs • openinfra</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Transport Infrastructure Data Packs">
<meta property="og:description" content="openinfra">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">openinfra</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/openinfra.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/QGIS_OSM_Setup.html">Getting and using OSM data with GUI QGIS</a>
    </li>
    <li>
      <a href="../articles/SOTM_workshop.html">SOTM 2022 Workshop - OSM for sustainable transport planning: getting started</a>
    </li>
    <li>
      <a href="../articles/data_packs.html">Transport Infrastructure Data Packs</a>
    </li>
    <li>
      <a href="../articles/getosm.html">Getting and using OSM data with the R package osmextract</a>
    </li>
    <li>
      <a href="../articles/im_get.html">Function and documentation for Inclusive Mobility guide (2021)</a>
    </li>
    <li>
      <a href="../articles/osm-python.html">Getting and using osm data in Python</a>
    </li>
    <li>
      <a href="../articles/package_networks.html">Network definitions (pre-defined networks) by OSM data package</a>
    </li>
    <li>
      <a href="../articles/regions.html">Transport regions in the UK</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/udsleeds/openinfra/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Transport Infrastructure Data Packs</h1>
                        <h4 data-toc-skip class="author">James Hulse</h4>
            
            <h4 data-toc-skip class="date">2022-09-05</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/udsleeds/openinfra/blob/HEAD/vignettes/data_packs.Rmd" class="external-link"><code>vignettes/data_packs.Rmd</code></a></small>
      <div class="hidden name"><code>data_packs.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="data-packs">Data Packs<a class="anchor" aria-label="anchor" href="#data-packs"></a>
</h2>
<p>This vignette covers the recategorisation of OpenStreetMap (OSM) infrastructure data into the openinfra transport infrastructure data packs. <br><br> The transport infrastructure data packs contain OSM infrastructure data for a given Local Authority District (LAD), as defined by the following polygons for <a href="https://github.com/udsleeds/openinfra/blob/main/data-small/lads_joined_2021.geojson" class="external-link">UK LADs</a>. <br><br> Whilst these LADs are currently being used to define the spatial area covered by each infrastructure data pack, any new set of updated boundaries (as a geojson file) can also be used to create the transport infrastructure data packs. <br><br></p>
<p>The LADs can be seen below:<br></p>
<iframe src="https://udsleeds.github.io/openinfraresults/tmap/assets/LADs_of_the_UK_new.html" width="650px" height="650px" data-external="1">
</iframe>
</div>
<div class="section level2">
<h2 id="current-data-pack-example-visualisations">Current Data Pack Example Visualisations<a class="anchor" aria-label="anchor" href="#current-data-pack-example-visualisations"></a>
</h2>
<p>This sections visualises the data pack outputs generated by the openinfra functions that are descibed in detail below.</p>
<p>The current example data pack outputs for a 2km circular radius about “Leeds” City Centre: <br><br> – Cleaned road descriptions <br> – Legally cyclable network <br> – Legally walkable network <br> – Presence of lighting network <br> – Cleaned maximum speed values <br> – Presence of cycle crossings <br> – Presence of cycle parking <br> – Recategorised road names <br><br><br></p>
<div class="section level3">
<h3 id="default-osm-highways">Default OSM Highways<a class="anchor" aria-label="anchor" href="#default-osm-highways"></a>
</h3>
<p>Please note that a 2Km circular buffer has been applied to the data so that the map can be hosted on this website. (max size 25Mb)<br> As can be seen, the default network has a variety of <code>highway</code> values and is rather confusing to the uninitiated OSM user. <iframe src="https://udsleeds.github.io/openinfraresults/tmap/assets/deault_OSM_highways.html" width="100%" height="650px" data-external="1"></iframe> <br><br></p>
</div>
<div class="section level3">
<h3 id="recategorised-road-descriptions">Recategorised Road Descriptions<a class="anchor" aria-label="anchor" href="#recategorised-road-descriptions"></a>
</h3>
<p>The recategorised road descriptions are more interpenetrate and meaningful than the default OSM highway values.</p>
<iframe src="https://udsleeds.github.io/openinfraresults/tmap/assets/road_desc_map.html" width="100%" height="650px" data-external="1">
</iframe>
<p>As can be seen - the OSM highways recategorised to road descriptions are much easier to visualise and insightful than all OSM highway values. <br><br></p>
</div>
<div class="section level3">
<h3 id="recategorised-cyclable-ways">Recategorised Cyclable Ways<a class="anchor" aria-label="anchor" href="#recategorised-cyclable-ways"></a>
</h3>
<iframe src="https://udsleeds.github.io/openinfraresults/tmap/assets/active_cycle_map.html" width="100%" height="650px" data-external="1">
</iframe>
<p>This visualisation shows the ways that cyclist legally have a right to access and use - note that this does not imply a “friendly” or “super safe” route, more that cyclists can use such ways if required. <br><br> An example application of this dataset could be highlighting the most likely roads that will be used by cyclists when switching from (intermittent) dedicated cycling infrastructure.</p>
<p><br><br></p>
</div>
<div class="section level3">
<h3 id="recategorised-walkable-ways">Recategorised Walkable Ways<a class="anchor" aria-label="anchor" href="#recategorised-walkable-ways"></a>
</h3>
<iframe src="https://udsleeds.github.io/openinfraresults/tmap/assets/active_walk_map.html" width="100%" height="650px" data-external="1">
</iframe>
<p>Much like the cycleable ways visualisation above, this visualisation shows ways that pedestrians legally have a right of way on. It does not assess or indicate any “friendliness” or “scenic-ness” of a way. <br><br></p>
</div>
<div class="section level3">
<h3 id="recategorised-presence-of-street-lighting">Recategorised Presence of Street Lighting<a class="anchor" aria-label="anchor" href="#recategorised-presence-of-street-lighting"></a>
</h3>
<iframe src="https://udsleeds.github.io/openinfraresults/tmap/assets/is_lit_map.html" width="100%" height="650px" data-external="1">
</iframe>
<p>Note that a value of <code>maybe</code> implies the lack of data to distinguish between <code>"yes"</code> or <code>"no"</code>. <br><br> Such information may be utilised to assess routes for safe active travel after dark. Likewise, complimented with Origin Destination (OD) data, one may identify active travel routes along high active travel traffic ways and implement lighting (if not present) to increase the safety of such routes after dark.</p>
<p><br><br></p>
</div>
<div class="section level3">
<h3 id="cleaned-maximum-speeds-uk">Cleaned Maximum Speeds (UK)<a class="anchor" aria-label="anchor" href="#cleaned-maximum-speeds-uk"></a>
</h3>
<iframe src="https://udsleeds.github.io/openinfraresults/tmap/assets/clean_maxspeed_map.html" width="100%" height="650px" data-external="1">
</iframe>
<p>Recategorised UK maximum road speed values. Based on the official <a href="https://www.gov.uk/speed-limits" class="external-link">UK speed limits</a>. <br><br></p>
</div>
<div class="section level3">
<h3 id="presence-of-cycle-crossings">Presence of Cycle Crossings<a class="anchor" aria-label="anchor" href="#presence-of-cycle-crossings"></a>
</h3>
<iframe src="https://udsleeds.github.io/openinfraresults/tmap/assets/cycle_crossings_map.html" width="100%" height="650px" data-external="1">
</iframe>
<p>Identifies the presence of cycle crossings based on OSM data. <br><br></p>
</div>
<div class="section level3">
<h3 id="presence-of-cycle-parking">Presence of Cycle Parking<a class="anchor" aria-label="anchor" href="#presence-of-cycle-parking"></a>
</h3>
<iframe src="https://udsleeds.github.io/openinfraresults/tmap/assets/cycle_parking_map.html" width="100%" height="650px" data-external="1">
</iframe>
<p>Identifies the presence of cycle parking facilities based on OSM data. <br><br></p>
</div>
<div class="section level3">
<h3 id="recategorised-road-names">Recategorised Road Names<a class="anchor" aria-label="anchor" href="#recategorised-road-names"></a>
</h3>
<iframe src="https://udsleeds.github.io/openinfraresults/tmap/assets/road_namesmap.html" width="100%" height="650px" data-external="1">
</iframe>
<p>Recategorises OSM to provide more descriptive road names useful for discussion and targeted analysis. <br><br> For example, <a href="https://www.openstreetmap.org/way/23200835" class="external-link"><code>osm_id:23200835</code></a> is less useful as a name than, <code>Lovell Park Road</code> <br><br></p>
</div>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>The following libraries are required for the production of transport infrastructure data packs.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-tmap/tmap" class="external-link">tmap</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/udsleeds/openinfra/" class="external-link">openinfra</a></span><span class="op">)</span></span></code></pre></div>
<p><br><br></p>
<div class="section level3">
<h3 id="data-packs-the-function-definitions">Data Packs: The Function Definitions<a class="anchor" aria-label="anchor" href="#data-packs-the-function-definitions"></a>
</h3>
<p>This section covers the current Openinfra (<code>oi_</code>) functions utilised to recategorise and add value to OSM infrastructure network data. <br><br> Each Openinfra function is defined and described below. <br><br></p>
<div class="section level4">
<h4 id="function-oi_recode_road_class">Function: <code>oi_recode_road_class</code><a class="anchor" aria-label="anchor" href="#function-oi_recode_road_class"></a>
</h4>
<p>Below we can see the <code>recode_road_class</code> function. This function takes a SimpleFeatures (<a href="https://r-spatial.github.io/sf/index.html" class="external-link">sf</a>) osm infrastructure network and re-classifies features based on road classifications specified by <a href="https://www.nature.com/articles/s41598-019-55669-8" class="external-link">Chan and Cooper</a> in the following <a href="https://www.nature.com/articles/s41598-019-55669-8/tables/6" class="external-link">table</a>. <br><br><a href="https://www.nature.com/articles/s41598-019-55669-8" class="external-link">Chan and Cooper’s</a> work, <em>“Using road class as a replacement for predicted motorized traffic flow in spatial network models of cycling”</em>. <br><br> Cycling models require the simulation of motorised traffic in order to simulate motorised traffic movement to be considered in cycling models for route planning (cyclists won’t enjoy being on a busy road full of traffic!). <br><br> To model a given area for cycling, simulated motorised traffic must be modelled for a circular area (∝r<sup>2</sup>) 20x that of the cyclists, as zonal Origin Destination (OD) data is used for the entire car trip (typical car journey range ~30km to a cyclists ~7km). <br><br> Accurately modelling motor traffic for such a larger area requires much more data, time, and money than that required to model for cyclists, this becomes even more of an issue when comparing budgets for cyclist modelling and motorised traffic modelling. <br><br><a href="https://www.nature.com/articles/s41598-019-55669-8" class="external-link">Work</a> by Chan and Cooper propose estimating road traffic based on road classes, as defined in the table above, negating the requirement for the costly and time consuming modelling of motorised traffic.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define recode_road_class function</span></span>
<span><span class="va">oi_recode_road_class</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">osm_sf</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># browser() Uncomment this to perform function debugging </span></span>
<span>  </span>
<span>  <span class="co"># Created road_class columns</span></span>
<span>  <span class="va">osm_recat</span> <span class="op">=</span> <span class="va">osm_sf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="co"># Creates road_class column</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>oi_road_class <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="co"># (7) - Motorways</span></span>
<span>      <span class="va">highway</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"motorway"</span>, <span class="st">"motorway_link"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"7"</span>,</span>
<span>      <span class="co"># (6/5) - Dual Carriageways resi &amp; non-resi</span></span>
<span>      <span class="va">highway</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"trunk"</span>, <span class="st">"trunk_link"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"6/5"</span>,</span>
<span>      <span class="co"># (4) - Primary Roads</span></span>
<span>      <span class="va">highway</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"primary"</span>, <span class="st">"primary_link"</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span><span class="va">highway</span> <span class="op">==</span> <span class="st">"trunk"</span> <span class="op">&amp;</span> <span class="va">oneway</span> <span class="op">==</span> <span class="st">"F"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"4"</span>,</span>
<span>      <span class="co"># (3) - Secondary Roads</span></span>
<span>      <span class="va">highway</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"secondary"</span>, <span class="st">"secondary_link"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"3"</span>,</span>
<span>      <span class="co"># (2) - Tertiary Roads</span></span>
<span>      <span class="va">highway</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tertiary"</span>, <span class="st">"tertiary_link"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"2"</span>,</span>
<span>      <span class="co"># (1) - Local Roads</span></span>
<span>      <span class="va">highway</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"living_street"</span>, <span class="st">"residential"</span>, <span class="st">"unclassified"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"1"</span>,</span>
<span>      <span class="co"># (0) - Traffic-free Paths</span></span>
<span>      <span class="va">highway</span> <span class="op">==</span> <span class="st">"cycleway"</span> <span class="op">~</span> <span class="st">"0"</span></span>
<span>    <span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    </span>
<span>    <span class="co"># Creates road_description columns</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>oi_road_desc <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="co"># (7) - Motorways</span></span>
<span>      <span class="va">highway</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"motorway"</span>, <span class="st">"motorway_link"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Motorways"</span>,</span>
<span>      <span class="co"># (6/5) - Dual Carriageways resi &amp; non-resi</span></span>
<span>      <span class="op">(</span><span class="va">highway</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"trunk"</span>, <span class="st">"trunk_link"</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">oneway</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"yes"</span>, <span class="st">"-1"</span>, <span class="st">"reversible"</span>, <span class="st">"alternating"</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Dual Carriageways (R&amp;NR)"</span>,</span>
<span>      <span class="co"># (4) - Primary Roads</span></span>
<span>      <span class="va">highway</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"primary"</span>, <span class="st">"primary_link"</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span><span class="va">highway</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"trunk"</span>, <span class="st">"trunk_link"</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="op">!</span> <span class="va">oneway</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"yes"</span>, <span class="st">"-1"</span>, <span class="st">"reversible"</span>, <span class="st">"alternating"</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Primary Roads"</span>,</span>
<span>      <span class="co"># (3) - Secondary Roads</span></span>
<span>      <span class="va">highway</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"secondary"</span>, <span class="st">"secondary_link"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Secondary Roads"</span>,</span>
<span>      <span class="co"># (2) - Tertiary Roads</span></span>
<span>      <span class="va">highway</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tertiary"</span>, <span class="st">"tertiary_link"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Tertiary Roads"</span>,</span>
<span>      <span class="co"># (1) - Local Roads</span></span>
<span>      <span class="va">highway</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"living_street"</span>, <span class="st">"residential"</span>, <span class="st">"unclassified"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Residential / Local Roads"</span>,</span>
<span>      <span class="co"># (0) - Traffic-free Paths</span></span>
<span>      <span class="va">highway</span> <span class="op">==</span> <span class="st">"cycleway"</span> <span class="op">~</span> <span class="st">"Cycleway"</span></span>
<span>    <span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    </span>
<span>    <span class="co"># Removes features that have not been recodeed to a road_class value</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">oi_road_class</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><br><br></p>
<p>As discussed, the above function was defined defined based on the following table from Chan and Cooper:</p>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th>Road Class</th>
<th>Description</th>
<th>Selection from OSM</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>7</td>
<td>Motorways</td>
<td>
<code>highway = motorway</code> <strong>OR</strong> <code>highway = motorway_link</code>
</td>
</tr>
<tr class="even">
<td>6</td>
<td>Non-residential Dual Carriageways</td>
<td>
<code>highway =  trunk</code> <strong>OR</strong> <code>highway = trunk_link</code> <strong>AND</strong> <code>oneway = yes</code><em>&amp; manual classification needed</em>
</td>
</tr>
<tr class="odd">
<td>5</td>
<td>Residential Dual Carriageways</td>
<td>
<code>highway =  trunk</code> <strong>OR</strong> <code>highway =  trunk_link</code> <strong>AND</strong> <code>oneway = yes</code> <em>&amp; manual classification needed</em>
</td>
</tr>
<tr class="even">
<td>4</td>
<td>Primary Roads</td>
<td>(<code>highway =  primary</code> <strong>OR</strong> <code>highway = primary_link</code> <strong>OR</strong> <code>highway = trunk</code>) <strong>AND</strong> <code>oneway != yes</code>)</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Secondary Roads</td>
<td>
<code>highway =  secondary</code> <strong>OR</strong> <code>highway =  secondary_link</code>
</td>
</tr>
<tr class="even">
<td>2</td>
<td>Tertiary Roads</td>
<td>
<code>highway = tertiary</code> <strong>OR</strong> <code>highway = tertiary_link</code>
</td>
</tr>
<tr class="odd">
<td>1</td>
<td>Local Roads</td>
<td>
<code>highway = living_street</code> <strong>OR</strong> <code>highway = residential</code> <strong>OR</strong> <code>highway = unclassified</code>
</td>
</tr>
<tr class="even">
<td>0</td>
<td>Traffic-free Paths</td>
<td><code>highway = cycleway</code></td>
</tr>
</tbody>
</table>
<p><br><br></p>
</div>
<div class="section level4">
<h4 id="function-oi_active_cycle">Function: <code>oi_active_cycle</code><a class="anchor" aria-label="anchor" href="#function-oi_active_cycle"></a>
</h4>
<p>Adds column <code>oi_active_cycle</code> with values <code>"yes"|"no"</code> depending on whether or not a way is cyclable by cyclists.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">oi_active_cycle</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">osm_sf</span>, <span class="va">remove</span><span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co">#browser() # Uncomment to debug</span></span>
<span>  <span class="va">osm_sf_cycle</span> <span class="op">=</span> <span class="va">osm_sf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>oi_cycle <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    </span>
<span>    <span class="co"># Highway cannot be NA</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">highway</span><span class="op">)</span> <span class="op">~</span> <span class="st">"no"</span>,</span>
<span>    </span>
<span>    <span class="co"># Highway values not appropriate for cycling</span></span>
<span>    <span class="va">highway</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'abandoned'</span>, <span class="st">'bus_guideway'</span>, <span class="st">'byway'</span>, <span class="st">'construction'</span>, </span>
<span>                   <span class="st">'corridor'</span>, <span class="st">'elevator'</span>, <span class="st">'fixme'</span>, <span class="st">'escalator'</span>, <span class="st">'gallop'</span>, </span>
<span>                   <span class="st">'historic'</span>, <span class="st">'no'</span>, <span class="st">'planned'</span>, <span class="st">'platform'</span>, <span class="st">'proposed'</span>, </span>
<span>                   <span class="st">'raceway'</span>, <span class="st">'steps'</span><span class="op">)</span> </span>
<span>    <span class="op">~</span> <span class="st">"no"</span>,</span>
<span>    </span>
<span>    <span class="co"># Create two cases to catch features typically not allowed for cyclists, but have been flagged appropriate:</span></span>
<span>    <span class="co"># 1 - If highway = "bad highway values" BUT bicycle = "good bicycle values" then assign ~ "yes",</span></span>
<span>    <span class="op">(</span><span class="va">highway</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'motorway'</span>, <span class="st">'motorway_link'</span>, <span class="st">'footway'</span>, <span class="st">'bridleway'</span>,<span class="st">'pedestrian'</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">bicycle</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'yes'</span>, <span class="st">'designated'</span>, <span class="st">'permissive'</span>, <span class="st">'destination'</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="st">"yes"</span>,</span>
<span>    <span class="op">(</span><span class="op">(</span><span class="va">highway</span> <span class="op">==</span> <span class="st">"footway"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="op">!</span> <span class="va">bicycle</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"no"</span>, <span class="st">"dismount"</span>, <span class="st">"private"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="op">!</span> <span class="va">access</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"private"</span>, <span class="st">"no"</span>, <span class="st">"permit"</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="st">"yes"</span>,</span>
<span>    </span>
<span>    <span class="co"># 2 - Assign highway = "bad highway values" ONLY as ~ "no". Ways that are appropriate for cyclists will already be assigned "yes" from above</span></span>
<span>    <span class="va">highway</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'motorway'</span>, <span class="st">'motorway_link'</span>, <span class="st">'footway'</span>, <span class="st">'bridleway'</span>,<span class="st">'pedestrian'</span><span class="op">)</span> <span class="op">~</span> <span class="st">"no"</span>,</span>
<span>    </span>
<span>    <span class="co"># Way must have access rights</span></span>
<span>    <span class="va">access</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'private'</span>, <span class="st">'no'</span><span class="op">)</span> <span class="op">~</span> <span class="st">"no"</span>,</span>
<span>    </span>
<span>    <span class="co"># Way must not bar cyclists</span></span>
<span>    <span class="va">bicycle</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'no'</span>, <span class="st">'private'</span>, <span class="st">'ue_sidepath'</span>, <span class="st">'restricted'</span><span class="op">)</span> <span class="op">~</span> <span class="st">"no"</span>, </span>
<span>    </span>
<span>    <span class="co"># Way must not contain "private" within the service tag</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"private"</span>, <span class="va">service</span><span class="op">)</span> <span class="op">~</span> <span class="st">"no"</span>,</span>
<span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Case_when above should have added "no" to all inappropriate features, now </span></span>
<span>  <span class="co"># find features that do not contain "no" and set as "yes"</span></span>
<span>  <span class="va">osm_sf_cycle</span><span class="op">$</span><span class="va">oi_cycle</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">osm_sf_cycle</span><span class="op">$</span><span class="va">oi_cycle</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"yes"</span></span>
<span>  </span>
<span>  <span class="co"># If remove = TRUE, filter out features that have oi_cycle == "no"</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">remove</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">osm_sf_cycle</span> <span class="op">=</span> <span class="va">osm_sf_cycle</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">osm_sf_cycle</span><span class="op">$</span><span class="va">oi_cycle</span> <span class="op">==</span> <span class="st">"yes"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">osm_sf_cycle</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><br><br></p>
</div>
<div class="section level4">
<h4 id="function-oi_active_walk">Function: <code>oi_active_walk</code><a class="anchor" aria-label="anchor" href="#function-oi_active_walk"></a>
</h4>
<p>Adds the column <code>oi_active_walk</code> with values <code>"yes"|"no"</code> depending on whether or not a way is walkable by pedestrians or not.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">oi_active_walk</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">osm_sf</span>, <span class="va">remove</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co">#browser() #&lt;-- Uncomment to debug function.</span></span>
<span>  <span class="va">osm_sf_walking</span> <span class="op">=</span> <span class="va">osm_sf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>oi_walk <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    </span>
<span>    <span class="co"># Highway tag cannot be NA</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">highway</span><span class="op">)</span> <span class="op">~</span> <span class="st">"no"</span>,</span>
<span>    </span>
<span>    <span class="co"># Highway tag cannot have un-walkable values</span></span>
<span>    <span class="va">highway</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'abandoned'</span>, <span class="st">'bus_guideway'</span>, <span class="st">'byway'</span>, <span class="st">'construction'</span>, </span>
<span>                   <span class="st">'corridor'</span>, <span class="st">'elevator'</span>, <span class="st">'fixme'</span>, <span class="st">'escalator'</span>, <span class="st">'gallop'</span>, </span>
<span>                   <span class="st">'historic'</span>, <span class="st">'no'</span>, <span class="st">'planned'</span>, <span class="st">'platform'</span>, <span class="st">'proposed'</span>,</span>
<span>                   <span class="st">'raceway'</span>, <span class="st">'motorway'</span>, <span class="st">'motorway_link'</span><span class="op">)</span> </span>
<span>    <span class="op">~</span> <span class="st">"no"</span>,</span>
<span>    </span>
<span>    <span class="co"># Hihgway tag cannot be a cycleway UNLESS walking is permitted</span></span>
<span>    <span class="op">(</span><span class="op">(</span><span class="va">highway</span> <span class="op">==</span> <span class="st">"cycleway"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">foot</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'yes'</span>, <span class="st">'designated'</span>, <span class="st">'permissive'</span>, <span class="st">'destination'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="st">"yes"</span>,</span>
<span>    <span class="co"># Below catches highway == cycleway and foot != values below INCLUDING NAs. </span></span>
<span>    <span class="op">(</span><span class="op">(</span><span class="va">highway</span> <span class="op">==</span> <span class="st">"cycleway"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="op">!</span> <span class="va">foot</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'yes'</span>, <span class="st">'designated'</span>, <span class="st">'permissive'</span>, <span class="st">'destination'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="st">"no"</span>,</span>
<span>    </span>
<span>    <span class="op">(</span><span class="va">highway</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"footway"</span>, <span class="st">"pedestrian"</span>, <span class="st">"path"</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="op">!</span> <span class="va">foot</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"no"</span>, <span class="st">"private"</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="op">!</span> <span class="va">access</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"private"</span>, <span class="st">"no"</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="st">"yes"</span>,</span>
<span>    </span>
<span>    <span class="co"># Access cannot be restricted</span></span>
<span>    <span class="op">(</span><span class="op">(</span><span class="va">access</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'private'</span>, <span class="st">'no'</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">foot</span> <span class="op">==</span> <span class="st">"yes"</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="st">"yes"</span>,</span>
<span>    <span class="op">(</span><span class="op">(</span><span class="va">access</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'private'</span>, <span class="st">'no'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="st">"no"</span>,</span>
<span>    </span>
<span>    <span class="co"># Foot usage must be permitted,</span></span>
<span>    <span class="va">foot</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'private'</span>, <span class="st">'no'</span>, <span class="st">'use_sidepath'</span>, <span class="st">'restricted'</span><span class="op">)</span> <span class="op">~</span> <span class="st">"no"</span>,</span>
<span>    </span>
<span>    <span class="co"># Service value does not contain "private"</span></span>
<span>    <span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"private"</span>, <span class="va">service</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">foot</span> <span class="op">==</span> <span class="st">"yes"</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="st">"yes"</span>,</span>
<span>    <span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"private"</span>, <span class="va">service</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">foot</span> <span class="op">!=</span> <span class="st">"yes"</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="st">"no"</span>,</span>
<span>    </span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># find features that do not contain "no" and set as "yes"</span></span>
<span>  <span class="va">osm_sf_walking</span><span class="op">$</span><span class="va">oi_walk</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">osm_sf_walking</span><span class="op">$</span><span class="va">oi_walk</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"yes"</span></span>
<span>  </span>
<span>  <span class="co"># If remove = TRUE, filter out features that have oi_walking == "no"</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">remove</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">osm_sf_walking</span> <span class="op">=</span> <span class="va">osm_sf_walking</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">osm_sf_walking</span><span class="op">$</span><span class="va">oi_walk</span> <span class="op">==</span> <span class="st">"yes"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">osm_sf_walking</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><br><br></p>
</div>
<div class="section level4">
<h4 id="function-oi_clean_maxspeed_uk">Function: <code>oi_clean_maxspeed_uk</code><a class="anchor" aria-label="anchor" href="#function-oi_clean_maxspeed_uk"></a>
</h4>
<p>Adds column <code>oi_maxspeed</code> that contains cleaned maxspeed values from OSM features, where the maxspeed field exists.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">oi_clean_maxspeed_uk</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">osm_sf</span>, <span class="va">no_NA</span> <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">del</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Define NOT IN </span></span>
<span>  <span class="va">`%!in%`</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Negate</a></span><span class="op">(</span><span class="va">`%in%`</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">osm_clean</span> <span class="op">=</span> <span class="va">osm_sf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>oi_maxspeed <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="co"># maxspeed == national, when on motorway</span></span>
<span>      <span class="op">(</span><span class="va">maxspeed</span> <span class="op">==</span> <span class="st">"national"</span> <span class="op">&amp;</span> <span class="va">highway</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"motorway"</span>, <span class="st">"motorway_link"</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="st">"70 mph"</span>,</span>
<span>      </span>
<span>      <span class="co"># maxspeed == national, when NOT on motorway</span></span>
<span>      <span class="op">(</span><span class="va">maxspeed</span> <span class="op">==</span> <span class="st">"national"</span> <span class="op">&amp;</span> <span class="va">highway</span> <span class="op">%!in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"motorway"</span>, <span class="st">"motorway_link"</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="st">"60 mph"</span>,  </span>
<span>      </span>
<span>      <span class="co"># maxspeed == national, when on standard (i.e Non-Residential) dual carriageway</span></span>
<span>      <span class="op">(</span><span class="va">maxspeed</span> <span class="op">==</span> <span class="st">"national"</span> <span class="op">&amp;</span> <span class="va">highway</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"trunk"</span>, <span class="st">"trunk_link"</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="st">"70 mph"</span>,</span>
<span>      </span>
<span>      <span class="co"># maxspeed == (20|30|40|50|60|70 --&gt; + mph)</span></span>
<span>      <span class="va">maxspeed</span> <span class="op">==</span> <span class="st">"20"</span> <span class="op">~</span> <span class="st">"20 mph"</span>,</span>
<span>      <span class="va">maxspeed</span> <span class="op">==</span> <span class="st">"30"</span> <span class="op">~</span> <span class="st">"30 mph"</span>,</span>
<span>      <span class="va">maxspeed</span> <span class="op">==</span> <span class="st">"40"</span> <span class="op">~</span> <span class="st">"40 mph"</span>,</span>
<span>      <span class="va">maxspeed</span> <span class="op">==</span> <span class="st">"50"</span> <span class="op">~</span> <span class="st">"50 mph"</span>,</span>
<span>      <span class="va">maxspeed</span> <span class="op">==</span> <span class="st">"60"</span> <span class="op">~</span> <span class="st">"60 mph"</span>,</span>
<span>      <span class="va">maxspeed</span> <span class="op">==</span> <span class="st">"70"</span> <span class="op">~</span> <span class="st">"70 mph"</span>,</span>
<span>      </span>
<span>      <span class="co"># Already cleaned speeds (to stop mutate missing these)</span></span>
<span>      <span class="va">maxspeed</span> <span class="op">==</span> <span class="st">"20 mph"</span> <span class="op">~</span> <span class="st">"20 mph"</span>,</span>
<span>      <span class="va">maxspeed</span> <span class="op">==</span> <span class="st">"30 mph"</span> <span class="op">~</span> <span class="st">"30 mph"</span>,</span>
<span>      <span class="va">maxspeed</span> <span class="op">==</span> <span class="st">"40 mph"</span> <span class="op">~</span> <span class="st">"40 mph"</span>,</span>
<span>      <span class="va">maxspeed</span> <span class="op">==</span> <span class="st">"50 mph"</span> <span class="op">~</span> <span class="st">"50 mph"</span>,</span>
<span>      <span class="va">maxspeed</span> <span class="op">==</span> <span class="st">"60 mph"</span> <span class="op">~</span> <span class="st">"60 mph"</span>,</span>
<span>      <span class="va">maxspeed</span> <span class="op">==</span> <span class="st">"70 mph"</span> <span class="op">~</span> <span class="st">"70 mph"</span>,</span>
<span>    <span class="op">)</span><span class="op">)</span> </span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">no_NA</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="co"># if TURE, will remove features if their oi_maxspeed == NA</span></span>
<span>    <span class="va">osm_clean</span> <span class="op">=</span> <span class="va">osm_clean</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">oi_maxspeed</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">del</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="co"># If TRUE, will delete original `maxspeed` column</span></span>
<span>    <span class="va">osm_clean</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">osm_clean</span>, select <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">maxspeed</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> </span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">osm_clean</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span></code></pre></div>
<p><br><br></p>
<p><br><br></p>
</div>
<div class="section level4">
<h4 id="function-oi_is_lit">Function: <code>oi_is_lit</code><a class="anchor" aria-label="anchor" href="#function-oi_is_lit"></a>
</h4>
<p>Adds column <code>oi_is_lit</code> with values <code>"yes"|"no"|"yes- LED"|"no -LED"|"maybe"</code> depending on whether the OSM way is lit or not, and if the lighting is LED or not. The value <code>"maybe"</code> implies that there is a lack of data to be able to distinguish - this is likely “yes” in built up urban areas, and “no” for more rural areas.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">oi_is_lit</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">osm_sf</span>, <span class="va">remove</span><span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Select only the ways that have a highway value (not train tracks etc.)</span></span>
<span>  <span class="va">osm_sf</span> <span class="op">=</span> <span class="va">osm_sf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">osm_sf</span><span class="op">$</span><span class="va">highway</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Recategorise the data</span></span>
<span>  <span class="va">osm_sf_lit</span> <span class="op">=</span> <span class="va">osm_sf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>oi_is_lit <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span> </span>
<span>    <span class="co"># If lit=* is not a unlit value - set as yes.</span></span>
<span>    <span class="op">(</span><span class="op">!</span> <span class="va">lit</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"no"</span>, <span class="st">"disused"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">lit</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="st">"yes"</span>,</span>
<span>    <span class="co"># If way is known to be unlit</span></span>
<span>    <span class="va">lit</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"no"</span>, <span class="st">"disued"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"no"</span>,</span>
<span>    </span>
<span>    <span class="co"># Used if street light is an LED (increasing popularity)</span></span>
<span>    <span class="va">lit_by_led</span> <span class="op">==</span> <span class="st">"yes"</span> <span class="op">~</span> <span class="st">"yes - LED"</span>,</span>
<span>    <span class="va">lit_by_led</span> <span class="op">==</span> <span class="st">"no"</span> <span class="op">~</span> <span class="st">"no - LED"</span>,</span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Finally - all remaining N/A are unknown as either lit or unlit.</span></span>
<span>  <span class="va">osm_sf_lit</span><span class="op">$</span><span class="va">oi_is_lit</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">osm_sf_lit</span><span class="op">$</span><span class="va">oi_is_lit</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"maybe"</span></span>
<span>  </span>
<span>  <span class="co"># If remove = TRUE, filter out features that have oi_is_lit == "no"</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">remove</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">osm_sf_lit</span> <span class="op">=</span> <span class="va">osm_sf_lit</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">osm_sf_lit</span><span class="op">$</span><span class="va">oi_is_lit</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"yes"</span>, <span class="st">"yes - LED"</span>, <span class="st">"maybe"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">osm_sf_lit</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><br><br><br><br></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="example-data-pack-production---leeds">Example Data Pack Production - Leeds<a class="anchor" aria-label="anchor" href="#example-data-pack-production---leeds"></a>
</h2>
<p>Here we go over a reproducible example of generating a transport infrastructure data pack from a OSM network retrieved using <a href="https://github.com/ropensci/osmextract" class="external-link"><code>osmextract</code></a>.</p>
<p><br><br> This example concerns the LAD of Leeds, UK. <br> Note that a 7.5km circular buffer has been applied (centered at Long, Lat coords (-1.548567, 53.801277)) to reduce map filesize so that the visualisations below can be hosted on this webpage. <br><br></p>
<div class="section level3">
<h3 id="getting-data">Getting Data<a class="anchor" aria-label="anchor" href="#getting-data"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Data downloaded through osmextract as shown below: </span></span>
<span></span>
<span><span class="co">#total_place = osmextract::oe_get(</span></span>
<span><span class="co">#  place = "Leeds",</span></span>
<span><span class="co">#  provider = "bbbike",</span></span>
<span><span class="co">#  layer = "lines",</span></span>
<span><span class="co">#  never_skip_vectortranslate = TRUE,</span></span>
<span><span class="co">#  force_download = TRUE,</span></span>
<span><span class="co">#  quiet = FALSE,</span></span>
<span><span class="co">#  extra_tags = c("foot", "bicycle", "access", "service", "maxspeed", "oneway",</span></span>
<span><span class="co">#                  "kerb", "footway", "sidewalk", "cycleway", "segregated", "highway",</span></span>
<span><span class="co">#                  "crossing", "lit", "tactile_paving", "surface", "smoothness", "width",</span></span>
<span><span class="co">#                  "est_width", "lit_by_led", "boundary", "admin_level", "name")</span></span>
<span><span class="co">#)</span></span>
<span></span>
<span><span class="co"># For reproduciblity you may chose to use the example dataset from our releases.</span></span>
<span><span class="co"># You can create your own data using the oe_get() function above.</span></span>
<span><span class="va">leeds_network</span> <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="st">"https://github.com/udsleeds/openinfra/releases/download/v0.2/Leeds.geojson"</span><span class="op">)</span></span></code></pre></div>
<p><br><br></p>
</div>
<div class="section level3">
<h3 id="applying-openinfra-functions---adding-value">Applying Openinfra Functions - Adding Value<a class="anchor" aria-label="anchor" href="#applying-openinfra-functions---adding-value"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">leeds_network</span> <span class="op">=</span> <span class="fu"><a href="../reference/oi_recode_road_class.html">oi_recode_road_class</a></span><span class="op">(</span><span class="va">leeds_network</span><span class="op">)</span> </span>
<span><span class="va">leeds_network</span> <span class="op">=</span> <span class="fu"><a href="../reference/oi_active_walk.html">oi_active_walk</a></span><span class="op">(</span><span class="va">leeds_network</span><span class="op">)</span></span>
<span><span class="va">leeds_network</span> <span class="op">=</span> <span class="fu"><a href="../reference/oi_active_cycle.html">oi_active_cycle</a></span><span class="op">(</span><span class="va">leeds_network</span><span class="op">)</span></span>
<span><span class="va">leeds_network</span> <span class="op">=</span> <span class="fu"><a href="../reference/oi_clean_maxspeed_uk.html">oi_clean_maxspeed_uk</a></span><span class="op">(</span><span class="va">leeds_network</span><span class="op">)</span></span>
<span><span class="va">leeds_network</span> <span class="op">=</span> <span class="fu"><a href="../reference/oi_inclusive_mobility.html">oi_inclusive_mobility</a></span><span class="op">(</span><span class="va">leeds_network</span><span class="op">)</span></span>
<span><span class="va">leeds_network</span> <span class="op">=</span> <span class="fu"><a href="../reference/oi_is_lit.html">oi_is_lit</a></span><span class="op">(</span><span class="va">leeds_network</span><span class="op">)</span></span></code></pre></div>
<p><br><br></p>
</div>
<div class="section level3">
<h3 id="selecting-relevant-columns-for-data-pack">Selecting Relevant Columns for Data Pack<a class="anchor" aria-label="anchor" href="#selecting-relevant-columns-for-data-pack"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">leeds_datapack</span> <span class="op">=</span> <span class="va">leeds_network</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span> <span class="st">"osm_id"</span>, <span class="st">"highway"</span>, <span class="st">"oi_road_desc"</span>, <span class="st">"oi_maxspeed"</span>, <span class="st">"oi_walk"</span>, <span class="st">"oi_cycle"</span>,</span>
<span> <span class="st">"oi_is_lit"</span>, <span class="st">"im_kerb"</span>, <span class="st">"im_footway"</span>, <span class="st">"im_footpath"</span>, <span class="st">"im_crossing"</span>, </span>
<span> <span class="st">"im_footway_imp"</span>, <span class="st">"im_light"</span>, <span class="st">"im_tactile"</span>, <span class="st">"im_surface_paved"</span>, <span class="st">"im_surface"</span>,</span>
<span> <span class="st">"im_width"</span>, <span class="st">"im_width_est"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Thus concludes the creation of the transport infrastructure data packs. <br><br> We can visualise these outputs below.</p>
<p><br><br><br><br></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by James Hulse, Greta Timaite, Robin Lovelace.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
